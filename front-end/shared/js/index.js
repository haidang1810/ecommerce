var product_list = [
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/200'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/100'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/300'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/400'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/500'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/200'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/300'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/100'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/400'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/220'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/230'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/240'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/440'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/550'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/350'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/140'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/510'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/420'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/320'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/290'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/410'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/470'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/450'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/460'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/350'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/360'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/250'
	},	
	{
		MaSP: 'abc',
		TenLoai: 'Bông Tay',
		TenSP: 'Bông tai bạc ý 925 nụ đá Silver khuyên tai trang sức',
		Gia: 20000,
		SoLuong: 100,
		ChietKhau: 10,
		DanhGia: 4,
		AnhBia: 'https://picsum.photos/210'
	},	
];
$("#btn-show-pass-login").click(function(){
    if($("#input-password-login").attr("type") == "password"){
        $("#btn-show-pass-login").html(`<i class="fa-solid fa-eye-slash"></i>`);
        $("#input-password-login").attr("type","text");
    }else {
        $("#btn-show-pass-login").html(`<i class="fa-solid fa-eye"></i>`);
        $("#input-password-login").attr("type","password");
    }
})
$("#btn-show-pass-register").click(function(){
    if($("#input-password-register").attr("type") == "password"){
        $("#btn-show-pass-register").html(`<i class="fa-solid fa-eye-slash"></i>`);
        $("#input-password-register").attr("type","text");
    }else {
        $("#btn-show-pass-register").html(`<i class="fa-solid fa-eye"></i>`);
        $("#input-password-register").attr("type","password");
    }
})
$('#input-register-phone').on('keypress', function (event) {
    var charCode = !event.charCode ? event.which : event.charCode;
    if( charCode == 46 || charCode == 69 || charCode == 101 
    || charCode == 45 || charCode == 43)
        event.preventDefault();
});
fetch(BASE_URL+API_CATEGORY+CATEGORY_GETALL,{
	method: 'GET', 
	credentials: 'include',
	headers:{
		'Content-Type': 'application/json',
		'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept'
	}
})
	.then(statusRes)
	.then(json)
	.then(data => {
		if(data.status == 1){
			data.data.map((item, index)=>{
				if(index==0){
					$(".category__list").append(`
						<li class="category__item category__item--active">
							<a id="${item.MaLoai}" class="category__link">${item.TenLoai}</a>
						</li>
					`);
				}else{
					$(".category__list").append(`
						<li class="category__item">
							<a id="${item.MaLoai}" class="category__link">${item.TenLoai}</a>
						</li>
					`);
				}
			})
		}
	})
	.catch(handlerError);

let perPage = 8;
let currentPage = 1;
let start = (currentPage-1) * perPage;
let end = currentPage * perPage;

function renderProduct(list){
	$(".list-item").html("");
	let totalPage = Math.ceil(list.length / perPage);
	renderPagingBtn(totalPage,list);
	let html= ``;
	list.map((item, index)=>{
		if(index>=start && index<end){
			html += `
			<div class="card">
				<a href="./chi_tiet_san_pham" class="card-link">
					<img src="${item.AnhBia}" class="card-img-top" alt="Đang tải...">
					<div class="card-body">
						<div class="card-title">
							${item.TenSP}
						</div>`;
			if(item.ChietKhau){
				let price = Number(item.Gia);
				let discount = Number(item.ChietKhau);
				let newPrice = price - (price * discount / 100);
				let priceMoneyFormat = numberWithCommas(price)+'đ';
				let newPriceMoneyFormat = numberWithCommas(newPrice)+'đ';
				html += `	<div class="card-price">
							<span class="card-price-old">
								${priceMoneyFormat}
							</span>
							<span class="card-price-current">
							${newPriceMoneyFormat}
							</span>
						</div>`;
			}else{
				let price = Number(item.Gia);
				let priceMoneyFormat = numberWithCommas(price)+'đ';
				html += `	<div class="card-price">
							<span class="card-price-old">
								
							</span>
							<span class="card-price-current">
							${priceMoneyFormat}
							</span>
						</div>`;
			}
			html += ` 	<div class="card-category"><i class="fa fa-tag ng-hide"></i>${item.TenLoai}</div>`;
			html += `
						<div class="card-rating">`;
			if(item.DanhGia)
				html += renderStarRating(item.DanhGia);
			else html += `<i class="fa fa-star checked" style="opacity: 0 !important;"></i>`;
			html += `	</div>
					</div>
				</a>
			</div>
			`;
		}
	});
	$(".list-item").html(html);
}
function renderPagingBtn(totalPage,listProductRender){
	let html = `
	<button class="pagination__btn pagination__btn--prev">
		<i class="fa-solid fa-angle-left"></i>
	</button>
	`;
	if(totalPage < 7){
		for(let i=1; i<=totalPage; i++){
			if(i==currentPage)
				html += `
					<button class="pagination__btn 
					pagination__btn--page pagination__btn--number
					pagination__btn--active">
						${i}
					</button>
				`;
			else html += `
					<button class="pagination__btn 
					pagination__btn--page pagination__btn--number">
						${i}
					</button>
				`;
		}
	}else {
		for(let i=1; i<=3; i++){
			if(i==currentPage)
				html += `
					<button class="pagination__btn 
					pagination__btn--page pagination__btn--number
					pagination__btn--active">
						${i}
					</button>
				`;
			else html += `
					<button class="pagination__btn 
					pagination__btn--page pagination__btn--number">
						${i}
					</button>
				`;
		}
		html += `
			<button class="pagination__btn pagination__btn--page">
				...
			</button>
		`;
		for(let i=totalPage-2; i<=totalPage; i++){
			if(i==currentPage)
				html += `
					<button class="pagination__btn 
					pagination__btn--page pagination__btn--number
					pagination__btn--active">
						${i}
					</button>
				`;
			else html += `
					<button class="pagination__btn 
					pagination__btn--page pagination__btn--number">
						${i}
					</button>
				`;
		}
	}
	html += `
		<button class="pagination__btn pagination__btn--next">
			<i class="fa-solid fa-angle-right"></i>
		</button>
	`;
	$(".home-pagination").html(html);
	$(".pagination__btn--next").click(function(){
		currentPage++;
		if(currentPage > totalPage)
			currentPage = totalPage;
		start = (currentPage-1) * perPage;
		end = currentPage * perPage;
		renderProduct(listProductRender);
	});
	$(".pagination__btn--prev").click(function(){
		currentPage--;
		if(currentPage <= 1)
			currentPage = 1;
		start = (currentPage-1) * perPage;
		end = currentPage * perPage;
		renderProduct(listProductRender);
	});
	$(".pagination__btn--number").click(function(){
		currentPage = Number($(this).html());
		start = (currentPage-1) * perPage;
		end = currentPage * perPage;
		renderProduct(listProductRender);
	})
}


fetch(BASE_URL+API_PRODUCT+PRODUCT_GETALL,{
	method: 'GET', 
	credentials: 'include',
	headers:{
		'Content-Type': 'application/json',
		'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept'
	}
})
	.then(statusRes)
	.then(json)
	.then(data => {
		if(data.status == 1){
			product_list.push(...data.data);
			console.log(product_list);
			renderProduct(product_list);
		}
	})
	.catch(handlerError);

